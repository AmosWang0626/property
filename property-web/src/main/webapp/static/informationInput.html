<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>信息查询</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../plugins/layui/css/layui.css" media="all">
</head>
<body>
<blockquote class="layui-elem-quote layui-text">
    点击单元格可修改用户数据!
</blockquote>

<div class="demoTable">
    搜索ID：
    <div class="layui-inline">
        <input class="layui-input" name="memberId" id="demoReload" autocomplete="off">
    </div>
    <button class="layui-btn" data-type="reload" id="searchBtn">搜索</button>
</div>

<table class="layui-table" lay-data="{url:'/information/users', id:'demoEvent'}" lay-filter="demoEvent">
    <thead>
    <tr>
        <th lay-data="{field:'memberId', width:80}">ID</th>
        <th lay-data="{field:'nickname', width:120}">用户名</th>
        <th lay-data="{field:'water', width:130, event: 'setWater', style:'cursor: pointer;'}">本月用水(m³)</th>
        <th lay-data="{field:'electric',width:130,event: 'setElectric', style:'cursor: pointer;'}">本月用电(度)</th>
        <th lay-data="{field:'internet',width:130,event: 'setInternet', style:'cursor: pointer;'}">本月网费</th>
        <th lay-data="{field:'property',width:130,event: 'setProperty', style:'cursor: pointer;'}">本月物业费</th>
    </tr>
    </thead>
</table>

<script src="../plugins/layui/layui.all.js"></script>

<script>
    layui.use('table', function(){
        var table = layui.table;

        //监听单元格事件
        table.on('tool(demoEvent)', function(obj){
            var data = obj.data;
            if(obj.event === 'setWater'){
                layer.prompt({
                    formType: 2
                    ,title: '修改['+ data.nickname +'] 的本月用水(m³)为：'
                    ,value: data.water
                }, function(value, index){
                    layer.close(index);
                    //这里一般是发送修改的Ajax请求
                    $.ajax({
                        url:'/information/updateByWater',
                        type:'POST',
                        data:{memberId:data.memberId,water:value},
                        dataType:'json',
                        success:function (data) {
                            if (data){
                                //同步更新表格和缓存对应的值
                                obj.update({
                                    water: value
                                });
                            }
                        }
                    });

                });
            }
            if(obj.event === 'setElectric'){
                layer.prompt({
                    formType: 2
                    ,title: '修改['+ data.nickname +'] 的本月用电(度)为：'
                    ,value: data.electric
                }, function(value, index){
                    layer.close(index);

                    //这里一般是发送修改的Ajax请求
                    $.ajax({
                        url:'/information/updateByElectric',
                        type:'POST',
                        data:{memberId:data.memberId,electric:value},
                        dataType:'json',
                        success:function (data) {
                            if (data){
                                //同步更新表格和缓存对应的值
                                obj.update({
                                    electric: value
                                });
                            }
                        }
                    });

                });
            }
            if(obj.event === 'setInternet'){
                layer.prompt({
                    formType: 2
                    ,title: '修改['+ data.nickname +'] 的本月网费为：'
                    ,value: data.internet
                }, function(value, index){
                    layer.close(index);
                    //这里一般是发送修改的Ajax请求
                    $.ajax({
                        url:'/information/updateByInternet',
                        type:'POST',
                        data:{memberId:data.memberId,internet:value},
                        dataType:'json',
                        success:function (data) {
                            if (data){
                                //同步更新表格和缓存对应的值
                                obj.update({
                                    internet: value
                                });
                            }
                        }
                    });

                });
            }
            if(obj.event === 'setProperty'){
                layer.prompt({
                    formType: 2
                    ,title: '修改['+ data.nickname +'] 的本月物业费为：'
                    ,value: data.property
                }, function(value, index){
                    layer.close(index);
                    //这里一般是发送修改的Ajax请求
                    $.ajax({
                        url:'/information/updateByProperty',
                        type:'POST',
                        data:{memberId:data.memberId,property:value},
                        dataType:'json',
                        success:function (data) {
                            if (data){
                                //同步更新表格和缓存对应的值
                                obj.update({
                                    property: value
                                });
                            }
                        }
                    });

                });
            }
        });


        var $ = layui.$, active = {
            reload: function(){
                var demoReload = $('#demoReload');
                //执行重载
                table.reload('demoEvent', {
                    page: {
                        curr: 1 //重新从第 1 页开始
                    }
                    ,where: {
                        key: {
                            memberId: demoReload.val()
                        }
                    }
                });
            }
        };


        $('#searchBtn').on('click', function(){
            var type = $(this).data('type');
            active[type] ? active[type].call(this) : '';
        });
    });
</script>

</body>
</html>